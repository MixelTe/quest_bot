from random import choice
from time import sleep
from typing import Callable

import bafser_tgapi as tgapi

from bot.bot import Bot
from bot.control import forward
from data.user import User
from utils import clear_input, reply_markup

ME = tgapi.MessageEntity
type tfn = Callable[[Bot, User], None]
_story_parts: dict[str, tfn] = {}


def answer_story(bot: Bot):
    fn = _story_parts.get(bot.user.state)
    if fn:
        fn(bot, bot.user)
    else:
        forward(bot.sendMessage("–í–ï–õ–ò–ö–ê –û–©–ò–ë–ö–ê!"))


def story_part(fn: tfn):
    _story_parts[fn.__name__] = fn
    return fn


@story_part
def started(bot: Bot, user: User):
    state, args = user.get_state()
    if args[0] == 1:
        return
    user.set_state(state, [1])
    for text in [
        "–•–∞–π\\!",
        "–í–æ—Ç –≤–∞–º –º–æ–π *–£–ª—å—Ç–∏–º–∞—Ç—É–º*\\!\\!\\!",
        "–Ø –≤–∞—Å –ø—Ä–æ–±–∏–ª –ø–æ –∞–π–ø–∏",
        "–í—ã –º–µ–Ω—è –Ω–µ –ø–æ–∑–≤–∞–ª–∏ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∏ —Ç–µ–ø–µ—Ä—å *–ø–æ–∂–∞–ª–µ–µ—Ç–µ* –æ–± —ç—Ç–æ–º\\!",
        "–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª –¥–ª—è –≤–∞—Å –ø–æ–¥–∞—Ä–æ—á–µ–∫ \\-  *250–∫ —Ç–æ–Ω–Ω —Ç—Ä–æ—Ç–∏–ª–∞* üòÇ –û–Ω–∏ —Å–ø—Ä—è—Ç–∞–Ω—ã –≤ —Ç–∞–π–Ω–∏–∫–µ –¥–æ 14:00\\. –ê –ø–æ—Ç–æ–º \\- –≤—Å–µ, –≤—Å–µ–º—É –∫–æ–Ω–µ—Ü\\!",
        "–•–æ—Ç–∏—Ç–µ —Å–ø–∞—Å—Ç–∏ —Å–≤–æ–∏ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ \\- –Ω–∞–π–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–æ–µ–≥–æ —Ç–∞–π–Ω–∏–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –ª–µ–∂–∏—Ç 145 —à–∞–ª–∫–µ—Ä–æ–≤ –¢–ù–¢, –∞ –µ—â–µ —É –º–µ–Ω—è –∑–∞–ª–æ–∂–Ω–∏–∫ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è",  # noqa E501
        "–ò—â–∏—Ç–µ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ –∏ —Ç—Ä–µ–ø–µ—â–∏—Ç–µ –æ—Ç —Å—Ç—Ä–∞—Ö–∞\\! –•–∞\\-—Ö–∞\\! ü§™",
    ]:
        bot.sendChatAction("typing")
        st = len(text) * 0.02 - 0.25
        if st > 0:
            sleep(st)
        forward(bot.sendMessage(text, use_markdown=True))
    bot.sendChatAction("choose_sticker")
    sleep(1)
    forward(bot.sendSticker("CAACAgEAAxUAAWjZGdMrUNNR5rRbAsVXv_X_xpZ-AAKCAgAC1jEpR2is5WGi39g8NgQ"))
    sleep(15)
    bot.sendChatAction("typing")
    sleep(5)
    bot.sendChatAction("typing")
    sleep(5)
    text = "–†–µ–±—è—Ç–∞, –ø–æ–∫–∞ –ì—Ä–∏—Ñ–µ—Ä –ø–æ—à–µ–ª –Ω–∞–ª–∏–≤–∞—Ç—å —Å–µ–±–µ —á–∞–π —è –ø—Ä–æ–±—Ä–∞–ª—Å—è –∫ –µ–≥–æ –∫–æ–º–ø—É –∏ —É–º–æ–ª—è—é –º–Ω–µ –ø–æ–º–æ—á—å! –Ø –∏ –µ—Å—Ç—å —Ç–æ—Ç —Å–∞–º—ã–π –∑–∞–ª–æ–∂–Ω–∏–∫! –ö—É–¥–∞ –º–µ–Ω—è —Å–ø—Ä—è—Ç–∞–ª–∏, —è –Ω–µ –∑–Ω–∞—é, —Å–ª—ã—à–∞–ª —Ç–æ–ª—å–∫–æ –æ–±—Ä—ã–≤–∫–∏ —Ñ—Ä–∞–∑. –ò–¥–∏—Ç–µ –ø–æ –Ω–∞—à–∏–º —Å–ª–µ–¥–∞–º. –ë—É–¥—É –≤—ã—Å—ã–ª–∞—Ç—å –∏—Ö –ø—Ä–∏–º–µ—Ç—ã. –°–ø–∞—Å–∏—Ç–µ! –ü–æ–º–æ–≥–∏—Ç–µ!"  # noqa E501
    forward(bot.sendMessage(text, reply_markup=reply_markup([("–í–ø–µ—Ä—ë–¥!", "start_quest")])))


@story_part
def task1(bot: Bot, user: User):
    task = "–ú—ã –≤ –ª—é–±–∏–º–æ–º  –º–µ—Å—Ç–µ –æ–±–∏—Ç–∞–Ω–∏—è —É—Ç–æ–∫. –ó–∞—á–µ–º-—Ç–æ –æ–Ω –ø–æ—Å—á–∏—Ç–∞–ª –∑–¥–µ—Å—å –≤—Å–µ –∫–∞—á–µ–ª–∏. –ü–æ—Å—á–∏—Ç–∞–π—Ç–µ –∏ –≤—ã –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π."
    answers = ("7", "—Å–µ–º—å", "seven")
    ok_phrase = ["–û, –≤–∏–∂—É —Ü–∏—Ñ—Ä—É", "–ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –≤—ã –≤–∑—è–ª–∏—Å—å –º–µ–Ω—è —Å–ø–∞—Å–∞—Ç—å!"]
    run_task(bot, user, task, answers, ok_phrase, "task2")


@story_part
def task2(bot: Bot, user: User):
    task = """
–û–Ω —á—Ç–æ\\-—Ç–æ –ø–æ–¥–±—Ä–æ—Å–∏–ª –≤ –ø—É–Ω–∫—Ç –û–∑–æ–Ω–∞, –∑–∞–º–µ—Ç–∏–ª –∞–¥—Ä–µ—Å: `–í–∏–Ω–Ω–∏—Ü–∫–∞—è, 15`\\. –°–∫–∞–∑–∞–ª —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∫–∞–∫–æ–π\\-—Ç–æ –ø–∞—Ä–æ–ª—å\\.
–ü–∞—Ä–æ–ª—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω:
```
–ê \\- 1
–ô \\- 1
–õ \\- 1
–ú \\- 1
–° \\- 1
```
""".strip()
    answers = ("4", "—á–µ—Ç—ã—Ä–µ", "four")
    ok_phrase = ["–û, –≤–∏–∂—É —Ü–∏—Ñ—Ä—É", "–Ø —Å–∞–º –Ω–µ –ø–æ–Ω—è–ª, –∫–∞–∫ —Ç—É—Ç –æ–∫–∞–∑–∞–ª—Å—è. –ö–æ–≥–¥–∞ —è —Å—é–¥–∞ –ø–æ–ø–∞–ª, –æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ –≤—Å–µ –∏–º–µ—é—Ç —É–≥–ª—ã, –∏ —è —Ç–æ–∂–µ –Ω–∞—á–∏–Ω–∞—é –∑–∞—É–≥–ª—è—Ç—å—Å—è‚Ä¶"]
    run_task(bot, user, task, answers, ok_phrase, "task3", use_markdown=True)


@story_part
def task3(bot: Bot, user: User):
    task = "–í–∏–∂—É –ø–∞–º—è—Ç–Ω–∏–∫ –∫–∞–∫–æ–º—É-—Ç–æ —Å–ø–∞—Å–∞—Ç–µ–ª—é, —Ä—è–¥–æ–º –µ–≥–æ –º–∞—à–∏–Ω–∞. –û–Ω –∑–∞–ø–∏—Å–∞–ª –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã. –ù–∞–≤–µ—Ä–Ω–æ–µ, –∏ –≤–∞–º –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è."
    answers = lambda ans: ans.replace(" ", "").replace("-", "").replace(".", "").replace("k", "–∫").replace("m", "–º") == "0101–º–∫–º"
    ok_phrase = ["–í–∏–∂—É, –≤—ã –Ω–∞—à–ª–∏ —Ç–æ, —á—Ç–æ –Ω–∞–¥–æ", "–ê —è –≤–µ–¥—å —Ç–æ–∂–µ —à–µ–ª –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è. –ù–æ –º–µ–Ω—è –ø–æ–π–º–∞–ª –ì—Ä–∏—Ñ–µ—Ä –∏ –¥–µ—Ä–∂–∏—Ç —É —Å–µ–±—è –≤–∑–∞–ø–µ—Ä—Ç–∏."]
    run_task(bot, user, task, answers, ok_phrase, "task4")


@story_part
def task4(bot: Bot, user: User):
    task = "–û–Ω –ø–æ—à–µ–ª —á–∏—Å—Ç–∏—Ç—å –∑—É–±—ã –ø–æ—Å–ª–µ –∑–∞–≤—Ç—Ä–∞–∫–∞. –ê –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏, –≤–æ —Å–∫–æ–ª—å–∫–æ –∑–∞–≤—Ç—Ä–∞–∫–∞–µ—Ç –°—ã—Ç—ã–π –ª–∏—Å?"
    answers = ("8.00", "8:00", "8 00", "8-00", "08.00", "08:00", "08 00", "08-00",
               "–≤ –≤–æ—Å–µ–º—å —á–∞—Å–æ–≤", "–≤–æ—Å–µ–º—å —á–∞—Å–æ–≤", "–≤ –≤–æ—Å–µ–º—å", "–≤ 8 —á–∞—Å–æ–≤", "8 —á–∞—Å–æ–≤")
    ok_phrase = ["–í–µ—Ä–Ω–æ", "–ì–æ–≤–æ—Ä—è—Ç, –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç–µ –º–æ–∂–Ω–æ –Ω–µ –∑–∞–≤—Ç—Ä–∞–∫–∞—Ç—å. –ö–∞–∫–æ–π —É–∂–∞—Å!"]
    run_task(bot, user, task, answers, ok_phrase, "task5")


@story_part
def task5(bot: Bot, user: User):
    task = "–í–∏–∂—É —à–∞—Ä –Ω–∞ –ø–ª–æ—â–∞–¥–∏. –ö–∞–∫–∞—è –∂–µ –Ω–∞ –Ω–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–ª—è –º–µ–Ω—è —Ñ—Ä–∞–∑–∞: ¬´–°–≤–æ–±–æ–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å‚Ä¶¬ª \n–Ø –Ω–µ —É—Å–ø–µ–ª –¥–æ—á–∏—Ç–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞‚Ä¶"
    answers = ("—á–∞—Å—Ç–∏—á–Ω–æ–π", )
    ok_phrase = ["–î–∞, —Ç–æ—á–Ω–æ! –ò–º–µ–Ω–Ω–æ —Ç–∞–∫!"]
    run_task(bot, user, task, answers, ok_phrase, "task6")


@story_part
def task6(bot: Bot, user: User):
    task = "–û–Ω —É—à–µ–ª —Å—Ç—Ä–∏—á—å –Ω–æ–≥—Ç–∏. –ù–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å—á–∏—Ç–∞–ª, —Å–∫–æ–ª—å–∫–æ –∫–∞–º–Ω–µ–π –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å, —á—Ç–æ–±—ã –±–æ—Ä—Ü–∞ –∑–∞ —Å–≤–æ–±–æ–¥—É –ª–∏—Ü–µ–∑—Ä–µ—Ç—å."
    answers = ("6", "—à–µ—Å—Ç—å", "six")
    ok_phrase = ["–•–æ—Ä–æ—à–æ, —è –∑–∞–ø–æ–º–Ω—é", "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç–µ, —è —Ç—É—Ç —É–∑–Ω–∞–ª, —á—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫—Ä–∏–ø–µ—Ä —Ä–∞–Ω—å—à–µ –±—ã–ª —Å–≤–∏–Ω—å–µ–π"]
    run_task(bot, user, task, answers, ok_phrase, "task7")


@story_part
def task7(bot: Bot, user: User):
    task = "–û–Ω –æ–ø—è—Ç—å –ø–æ—à–µ–ª –ø–∏—Ç—å —á–∞–π –≤–æ ¬´–í–∫—É—Å–Ω–æ, –Ω–æ –Ω–µ —Ç–æ—á–∫—É¬ª, —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ. –ù–∞ –∑–¥–∞–Ω–∏–∏ –∫—É—á–∞ —à–ø–∏–ª–µ–π. –ó–∞—á–µ–º-—Ç–æ –∏—Ö –≤—Å–µ –ø–æ—Å—á–∏—Ç–∞–ª. –í—ã —Ç–æ–∂–µ —Ç–∞–∫ –º–æ–∂–µ—Ç–µ."
    answers = ("20", "–¥–≤–∞–¥—Ü–∞—Ç—å", "twenty")
    ok_phrase = ["–ü–æ–π–¥–µ—Ç!", "–ê —è —Ç—É—Ç —É–∑–Ω–∞–ª, —á—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —Ä–∞–Ω—å—à–µ –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç–µ –∫—Ä–æ–≤–∞—Ç–∏ –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Å–Ω—ã–µ."]
    run_task(bot, user, task, answers, ok_phrase, "task8")


@story_part
def task8(bot: Bot, user: User):
    task = "–≠—Ç–æ—Ç –≥–∞–∑ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –≤ –≤–æ–∑–¥—É—Ö –ø–æ—Å–ª–µ –¥–æ–∂–¥—è, –∞ –∑–¥–µ—Å—å –≤–∏—Å–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ \\- —è –∑–∞–º–µ—Ç–∏–ª –µ–≥–æ –∞–¥—Ä–µ—Å:  `–†–∞–º–µ–Ω–∫–∏, –¥\\.6 –∫\\.2`\\. –°—é–¥–∞ –ì—Ä–∏—Ñ–µ—Ä —Ç–æ–∂–µ —á—Ç–æ\\-—Ç–æ –ø–æ–¥–±—Ä–æ—Å–∏–ª\\. –ü–∞—Ä–æ–ª—å –≤—ã —É–∂–µ –∑–Ω–∞–µ—Ç–µ\\."  # noqa E501
    answers = ("7", "—Å–µ–º—å", "seven")
    ok_phrase = ["–í–∏–∂—É —Ü–∏—Ñ—Ä—É. –ü—Ä–∏–≥–æ–¥–∏—Ç—Å—è, –Ω–∞–≤–µ—Ä–Ω–æ–µ."]
    run_task(bot, user, task, answers, ok_phrase, "task9", use_markdown=True)


@story_part
def task9(bot: Bot, user: User):
    task = """
–ó–∞—à–ª–∏ –≤ –∫–∞–∫–æ–π-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω—ã–π –¥–æ–º. –í –Ω–µ–º –ø–æ–¥—ä–µ–∑–¥–æ–≤ –±–æ–ª—å—à–µ, —á–µ–º —ç—Ç–∞–∂–µ–π! –û–Ω —á—Ç–æ-—Ç–æ –æ–ø—è—Ç—å –ø–æ–¥–±—Ä–æ—Å–∏–ª –≤ –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫.
–ü–æ–¥—ä–µ–∑–¥ - –ø–µ—Ä–µ–¥ –º–µ—Å—è—Ü–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –∏–º–µ–Ω–∏–Ω–Ω–∏–∫–∞
–ù–æ–º–µ—Ä —è—â–∏–∫–∞: –≤–æ–∑—Ä–∞—Å—Ç –∏–º–µ–Ω–∏–Ω–Ω–∏–∫–∞ —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –æ–∫—Ç—è–±—Ä–µ –∏ –æ—Ç–Ω—è—Ç—å —Å—É–±–±–æ—Ç—É.
–ö–æ–¥ –∑–Ω–∞–µ—Ç –ü—Ä–∏–Ω—Ü
""".strip()
    answers = ("1", "–æ–¥–∏–Ω", "one")
    ok_phrase = ["–ï—â–µ —Ü–∏—Ñ—Ä–∞ –ø–æ—è–≤–∏–ª–∞—Å—å. –ù–∞–≤–µ—Ä–Ω–æ–µ, –≤–∞–∂–Ω–∞—è."]
    run_task(bot, user, task, answers, ok_phrase, "task10")


@story_part
def task10(bot: Bot, user: User):
    task = "–¢–µ–ø–µ—Ä—å –æ–Ω –∑–¥–æ—Ä–æ–≤–æ –ø—Ä–æ–≥–æ–ª–æ–¥–∞–ª—Å—è –∏ –∏—â–µ—Ç, –≥–¥–µ –ø–æ–µ—Å—Ç—å. –ù–∞—à–µ–ª –∫–∞–∫–æ–π-—Ç–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ç–∏–ø–∞ ¬´—á–∞—è –±–æ–ª—å—à–µ –Ω–µ—Ç¬ª. –ü–æ—Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å –∏ —Å–ø–∞—Å–∏—Ç–µ –º–µ–Ω—è –Ω–∞–∫–æ–Ω–µ—Ü! –ö–æ–≥–¥–∞ –Ω–∞–π–¥–µ—Ç–µ —ç—Ç–æ –º–µ—Å—Ç–æ, –≤–≤–µ–¥–∏—Ç–µ –≤–µ—Å—å –∫–æ–¥ —Ü–µ–ª–∏–∫–æ–º, —è –≤–ø–∏—à—É –≤ –∫–æ–º–∞–Ω–¥–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥ –∏ –≤–∞—à–∏ –∏–º–µ–Ω–∞ –≤ –≤–∞–π—Ç –ª–∏—Å—Ç."  # noqa E501
    answers = ("471", "—á–µ—Ç—ã—Ä–µ —Å–µ–º—å –æ–¥–∏–Ω", "—á–µ—Ç—ã—Ä–µ—Å—Ç–∞ —Å–µ–º—å–¥–µ—Å—è—Ç—å –æ–¥–∏–Ω")
    ok_phrase = ["–ö–æ–¥ –ø–æ–ª—É—á–∏–ª. –í—ã –º–æ–ª–æ–¥—Ü—ã! –ú–æ–µ —Å–ø–∞—Å–µ–Ω–∏–µ –±–ª–∏–∑–∫–æ!"]
    run_task(bot, user, task, answers, ok_phrase, "quest_end")


@story_part
def quest_end(bot: Bot, user: User):
    state, args = user.get_state()
    if args[0] == 1:
        return
    user.set_state(state, [1])
    msg = "–£—Ä–∞, –º–Ω–µ –ø–æ–≤–µ–∑–ª–æ! –ó–¥–µ—Å—å –¥–æ–±—Ä–∞—è —Ñ–µ—è —Å –ø—Ä–∏–º–µ—Ç–∞–º–∏ –º–∞–º—ã –∏–º–µ–Ω–∏–Ω–Ω–∏–∫–∞, –∏ –æ–Ω–∞ –∑–∞–º–µ—Ç–∏–ª–∞ —á—Ç–æ-—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ. –ù–∞–¥–µ—é—Å—å, —á—Ç–æ —Å–∫–æ—Ä–æ –≤—ã –º–µ–Ω—è —Å–ø–∞—Å–µ—Ç–µ! –ú—ã –ø–æ–¥–Ω–∏–º–∞–ª–∏—Å—å –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ, –∫–∞–∂–µ—Ç—Å—è, –Ω–∞ –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–∂."  # noqa E501
    forward(bot.sendMessage(msg))

    bot.sendChatAction("typing")
    sleep(0.5)
    msg = "–ö–∞—Ä–∞—É–ª! –û–Ω –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ —è –≤–∞–º –ø–æ–º–æ–≥–∞—é! –ó–∞—á–µ–º –µ–º—É –ø–æ—Ä—à–µ–Ω—å? –ò –æ—Ç–∫—É–¥–∞ —É –Ω–µ–≥–æ –±–µ–¥—Ä–æ–∫?"
    forward(bot.sendMessage(msg))

    sleep(1)
    bot.sendChatAction("typing")
    sleep(0.5)
    msg = "–•–∞-—Ö–∞-—Ö–∞! –≠—Ç–æ—Ç –º–µ—Ä–∑–∫–∏–π —Ç–∏–ø –≤–∞–º –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–ª, –∏ –∑–∞ —ç—Ç–æ —è –∑–∞—Å—É–Ω—É–ª –µ–≥–æ –ø—Ä—è–º–æ –≤ –±–µ–¥—Ä–æ–∫. ü§£ –ò —Ç–µ–ø–µ—Ä—å –∑–¥–∞–Ω–∏–µ –∑–∞–º–∏–Ω–∏—Ä–æ"
    forward(bot.sendMessage(msg))


def run_task(bot: Bot, user: User, task: str, answers: tuple[str, ...] | Callable[[str], bool], ok_phrase: list[str], next_state: str, *,
             use_markdown: bool = False):
    state, args = user.get_state()
    if args[0] is None:
        user.set_state(state, [1])
        send_backvoice(bot)
        forward(bot.sendMessage(task, use_markdown=use_markdown, reply_markup=reply_markup([("–ü–æ–¥—Å–∫–∞–∑–∫–∞", "task_hint 0")])))
        return
    if not bot.message:
        return
    answer = clear_input(bot.message.text)
    if callable(answers) and answers(answer) or \
            isinstance(answers, tuple) and answer in answers:
        for msg in ok_phrase:
            bot.sendChatAction("typing")
            sleep(0.25)
            forward(bot.sendMessage(msg))
        user.set_state(next_state)
        answer_story(bot)
    else:
        send_you_are_wrong(bot)


def send_backvoice(bot: Bot):
    p1 = "–ì–æ–ª–æ—Å —Å–≤—ã—à–µ:\n"
    p2 = "–£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–≤–æ–∏ –¥—Ä—É–∑—å—è —Ä—è–¥–æ–º –∏ —Å–ª—ã—à–∞—Ç —Ç–µ–±—è."
    msg = p1 + p2
    forward(bot.sendMessage(msg, entities=[ME.italic(0, ME.len(p1)), ME.blockquote(ME.len(p1), ME.len(p2))]))


def send_you_are_wrong(bot: Bot):
    forward(bot.sendMessage(choice([
        "–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç", "–ù–µ–∞!", "–û–π-–æ–π-–æ–π!", "–ü—Ä–æ–≤–∞–ª!", "–ü—Ä–æ–º–∞—Ö!",
        "–ß—Ç–æ-—Ç–æ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –æ—Ç–≤–µ—Ç", "–£—à–∞–º–∏ —á—É—é, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç", "–ì–æ—Ç–æ–≤ –ø–æ—Å–ø–æ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –µ—â–µ –ø–æ–¥—É–º–∞—Ç—å",
        "–ë–æ—é—Å—å, —ç—Ç–æ –Ω–µ —Ç–∞–∫", "–¢–∞–∫–∏–µ —Å–µ–±–µ –º–∞–ª—å—á–∏–∫–∏", "–ù–µ –æ—á–µ–Ω—å –º–∞–ª—å—á–∏–∫–∏",
    ])))
